# Unified API Feature Changelog

## Overview
This update implements a Unified API feature that allows all AI models to use a single API endpoint with unified authentication, regardless of the selected model provider.

## Feature Description
The Unified API feature enables users to:
- Force all AI models to route through a single API endpoint
- Use unified authentication for all requests
- Select the API format (OpenAI, Anthropic, or Azure) that the unified endpoint expects
- Switch between different AI models while maintaining the same endpoint configuration

## Changes Made

### 1. Configuration Store (`app/store/access.ts`)
- Added `useUnifiedAPI` (boolean): Toggle to enable/disable unified API
- Added `unifiedBaseUrl` (string): The unified API endpoint URL
- Added `unifiedApiKey` (string): API key for unified endpoint authentication
- Added `unifiedApiFormat` (string): API format type ("openai" | "anthropic" | "azure")
- Added `isValidUnifiedAPI()` method to validate unified API configuration

### 2. New Unified API Handler (`app/client/platforms/unified.ts`) [NEW FILE]
- Created `UnifiedApi` class to handle unified API requests
- Implements dynamic API client selection based on configured format
- Handles URL construction and request routing
- Supports all standard LLM operations (chat, speech, usage, models)

### 3. API Client Updates (`app/client/api.ts`)
- Modified `ClientApi` constructor to check for unified API and return `UnifiedApi` instance when enabled
- Updated `getHeaders()` function to use unified API key when enabled
- Added unified API auth header logic based on selected format

### 4. OpenAI Platform Updates (`app/client/platforms/openai.ts`)
- Modified `path()` method to check for unified API and return unified endpoint when enabled
- Added logging for unified API endpoint usage

### 5. Settings UI (`app/components/settings.tsx`)
- Added new `unifiedApiConfigComponent` with:
  - Enable/disable checkbox for unified API
  - Endpoint URL input field
  - API key password input
  - API format dropdown (OpenAI, Anthropic, Azure)
- Integrated the component into the settings page after all provider configurations

### 6. Internationalization
- **English** (`app/locales/en.ts`):
  - Added translations for all unified API settings
- **Simplified Chinese** (`app/locales/cn.ts`):
  - Added translations: "使用统一 API", "统一 API 端点", etc.
- **Traditional Chinese** (`app/locales/tw.ts`):
  - Added translations: "使用統一 API", "統一 API 端點", etc.

## Usage Instructions

1. Navigate to Settings → Service Provider
2. Scroll down to find the "Unified API" section
3. Toggle "Use Unified API" to enable the feature
4. Enter your unified API endpoint (e.g., `https://api.example.com`)
5. Enter your API key for authentication
6. Select the API format your endpoint expects
7. Save settings

Once enabled, all AI model requests will be routed through the unified endpoint, regardless of which model is selected in the chat interface.

## Technical Implementation Details

### Request Flow
1. When unified API is enabled, `ClientApi` returns a `UnifiedApi` instance
2. `UnifiedApi` determines the appropriate underlying client based on the selected format
3. The underlying client's `path()` method is temporarily overridden to use the unified endpoint
4. Headers are modified to use the unified API key
5. Requests are sent to the unified endpoint with the model parameter from the chat configuration

### Security Considerations
- API keys are stored in the browser's local storage (same as other API keys)
- HTTPS is enforced by default (URLs without protocol are prefixed with `https://`)
- No API keys or sensitive data are logged to console

## Known Limitations
- The usage endpoint may not be available on all unified API providers
- Model listing depends on the unified API provider implementing the `/v1/models` endpoint
- Azure format requires the model name to be included in the URL path

## Future Enhancements
- Add connection testing functionality
- Support for custom headers
- Support for additional API formats
- Request/response transformation options